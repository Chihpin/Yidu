version: '3'

services:

  # test:
  #   image: 6fa7aa0a975f # tomcat-debug # tomcat:9.0.0-jre8-alpine
  #   ports: 
  #     - "8080:8080"
  #     - "8000:8000"
  #   # links:
  #   #   - yidu_db
  #   # depends_on:
  #   #   - yidu_db
  #   # environment:
  #   #   - JPDA_ADDRESS="8000"
  #   #   - JPDA_TRANSPORT="dt_socket"
  #   volumes:
  #     - ./target/YiDuNovel:/usr/local/tomcat/webapps/ROOT
  #     # - ./target/YiDuNovel.war:/usr/local/tomcat/webapps/ROOT.war
  #   restart: always

  
  yidu_spider:
    container_name: yidu_spider
    image: yidu_spider #'f498f9d0fa81' #yidu_spidercd 
    links:
      - yidu_db
    depends_on:
      - yidu
      - yidu_db
    environment:
      - YIDU_DB_HOST=192.168.202.128 # 本地 局域网 ip 不能用 localhost 127.0.0.1
      - YIDU_DB_PORT=5432
      - YIDU_DB_NAME=yidu
      - YIDU_DB_USER=postgres
      - YIDU_DB_PWD=postgres
      - SPIDER_SITE_NAME="天天阅读"
      - SPIDER_SITE_HOST="http://192.168.202.128:8080"
    # volumes_from:
    #   - yidu
    volumes:
      # - ./.volume/spider:/usr/local/spider
      - ./.volume/app:/usr/local/spider/www
    # volumes:
    #   # - yidu_volume:/usr/local/spider
    #   - yidu_volume:/usr/local/spider/books
    restart: always


  yidu:
    container_name: yidu
    image: yidu #'f498f9d0fa81' #yidu
    ports: 
      - "8080:8080"
    links:
      - yidu_db
    depends_on:
      - yidu_db
    environment:
      - YIDU_DB_HOST=192.168.202.128 # 本地 局域网 ip 不能用 localhost 127.0.0.1
      - YIDU_DB_PORT=5432
      - YIDU_DB_NAME=yidu
      - YIDU_DB_USER=postgres
      - YIDU_DB_PWD=postgres
    # volumes_from:
    #   - yidu_volume
    # volumes:
    #   - yidu_volume:/usr/local/tomcat/webapps/ROOT/books
    volumes:
      - ./.volume/app:/usr/local/tomcat/webapps/ROOT
    restart: always

  yidu_db:
    container_name: yidu_db
    container_name: postgres
    image: postgres
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_PASSWORD=postgres
      - POSTGRES_USER=postgres
      - POSTGRES_DB=postgres
    volumes:
      - ./.volume/postgresql:/var/lib/postgresql/data
    restart: always


# volumes:
#   yidu_volume:
      # - ./volume1
